import Head from "next/head";
import Hero from "../components/hero";
import { About } from "../components/about";
import { Featured } from "../components/featured";

import { BlogWidget } from "../components/blogWidget";

import { fetchAPI } from "../lib/api";
import { Article } from "../types/article";
import MainLayout from "../layouts/MainLayout";
import { Categories } from "../components/categories";
import algoliasearch from "algoliasearch/lite";
// import { InstantSearch, SearchBox, Hits } from "react-instantsearch-dom";

const searchClient = algoliasearch(
  "7Y0X9GZGW7",
  "0ca2a76d622ef2f1b18dbb275e716e85"
);

export interface HomeProps {
  articles?: Article[];
}

const Home = (props: HomeProps) => {
  // Use the first 4 articles as featured articles
  const featuredArticles = props.articles ? props.articles.slice(0, 4) : [];

  return (
    <MainLayout>
      <Head>
        <title>Perfect Heatlh Practice</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />

        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link
          href="https://fonts.googleapis.com/css2?family=Karla:wght@300;400;500;600;700display=swap"
          rel="stylesheet"
        />
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.3.1/themes/reset-min.css"
          integrity="sha256-t2ATOGCtAIZNnzER679jwcFcKYfLlw01gli6F6oszk8="
        ></link>
      </Head>

      <Hero />

      {/* <InstantSearch searchClient={searchClient} indexName="test_1pulse">
        <SearchBox />
        <Hits />
      </InstantSearch> */}

      <About />
      <Categories />
      {/* <Products /> */}
      <Featured />
      {/* <Blogs articles={props.articles} /> */}

      {/* Featured Blogs? */}
      <div
        className={
          "bg-white-800 p-2 md:grid grid-cols-4 gap-8 md:px-28 py-2 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-4  "
        }
      >
        {featuredArticles.map((entry) => {
          return <BlogWidget key={entry.id} article={entry} />;
        })}
        {featuredArticles.length === 0 && (
          <div>Check back soon for some featured articles</div>
        )}
      </div>

      {/* <Contact / */}
    </MainLayout>
  );
};

export default Home;

export async function getStaticProps() {
  // Run API calls in parallel
  const [articles, categories, homepage] = await Promise.all([
    fetchAPI("/articles?featured=true"),
    fetchAPI("/categories"),
    fetchAPI("/homepage"),
  ]);

  return {
    props: { articles, categories, homepage },
    revalidate: 1,
  };
}
